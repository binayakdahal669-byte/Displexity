# Displexity Compiler Tutorial & Reference

## Chapter 1: Getting Started

### Installation

**Windows:**
1. Ensure you have MinGW/GCC installed
2. Clone or download the Displexity repository
3. Run `build.bat` to compile

**Linux/macOS:**
1. Ensure you have GCC installed (usually pre-installed)
2. Run `bash build.sh`

### Your First Program

Create `hello.dis`:
```displexity
print "Hello, World!"
```

Compile and run:
```bash
disp hello.dis -o hello.c
gcc hello.c -o hello
./hello
```

Output: `Hello, World!`

## Chapter 2: Language Fundamentals

### Variables

Displexity uses dynamic typing. Variables are declared by assignment:

```displexity
x = 42
name = "Alice"
active = true
```

### Data Types

| Type | Example | Notes |
|------|---------|-------|
| `int` | `42`, `x + y` | 32-bit integer |
| `string` | `"hello"` | Text, immutable |
| `bool` | `true`, `false` | Boolean logic |

### Arrays

Arrays are first-class citizens:

```displexity
// Create array literal
numbers = Array[10, 20, 30, 40]

// Access element
first = numbers[0]  // 10

// Modify element
numbers[2] = 99

// Arrays are 0-indexed
last = numbers[3]   // 40
```

### Operators

#### Arithmetic
```displexity
sum = 10 + 5       // 15
diff = 10 - 5      // 5
prod = 10 * 5      // 50
quot = 10 / 5      // 2
```

#### Comparison
```displexity
x > 10             // Greater than
x < 10             // Less than
x == 10            // Equal to
x != 10            // Not equal
x >= 10            // Greater or equal
x <= 10            // Less or equal
```

#### Logical
```displexity
true && false      // AND
true || false      // OR
!true              // NOT
```

## Chapter 3: Control Flow

### If Statements

```displexity
x = 15
if (x > 10) {
    print "Large"
} else {
    print "Small"
}
```

### While Loops

```displexity
count = 0
while (count < 5) {
    print "Counting"
    count = count + 1
}
```

### For Loops

```displexity
for (i = 0; i < 10) {
    print "Iteration"
}
```

## Chapter 4: Functions

Functions allow code reuse and modularity.

### Declaration

```displexity
func add(a: int, b: int) -> int {
    result = a + b
    return result
}
```

- Parameter types are optional but recommended
- Return type specified after `->`
- Must use `return` statement

### Calling Functions

```displexity
sum = add(10, 20)
print "Sum is"
```

### No-Return Functions

```displexity
func greet(name: string) {
    print name
}

greet("Alice")
```

## Chapter 5: Classes

Classes bundle data together:

```displexity
class Person {
    name: string
    age: int
}
```

Currently, classes are data-only structures. Methods are planned for future versions.

## Chapter 6: Standard Library

The Displexity runtime includes utilities for common tasks.

### Array Functions

```c
// In C code generated by disp
dis_array arr = dis_array_create(sizeof(int), 10);
dis_array_push(&arr, &element);
void* elem = dis_array_get(&arr, index);
dis_array_free(&arr);
```

### String Functions

```c
dis_string str = dis_string_create("hello");
dis_string_free(&str);
```

### Graphics (Stub)

```c
dis_graphics_init();
dis_graphics_draw_rect(10, 20, 100, 50);
dis_graphics_close();
```

### HTTP (Stub)

```c
dis_http_response resp = dis_http_get("http://example.com");
dis_http_response_free(&resp);
```

## Chapter 7: Compilation

### Basic Usage

```bash
disp <input.dis> [options]
```

### Output Formats

#### C Code (default)
```bash
disp program.dis -o program.c -emit-c
gcc program.c -o program.exe
./program.exe
```

#### Assembly
```bash
disp program.dis -o program.asm -emit-asm
```

#### Executable (direct)
```bash
disp program.dis -o program.exe
./program.exe
```

### Compiler Options

```
-o <file>        Output file
-emit-c          Generate C (default)
-emit-asm        Generate x86-64 assembly
-h, --help       Show help
```

## Chapter 8: Project Organization

### Multi-file Projects

Use `.disproj` for larger projects:

```json
{
  "name": "MyApp",
  "main": "src/main.dis",
  "output": "dist/myapp.exe",
  "files": [
    "src/main.dis",
    "src/math.dis",
    "src/utils.dis"
  ]
}
```

### Headers

Create reusable code in `.dish` files:

```displexity
// utils.dish
func multiply(a: int, b: int) -> int {
    return a * b
}
```

Include in your project:

```displexity
// main.dis
include "utils.dish"

result = multiply(5, 3)
print "Result is"
```

### Libraries

Place compiled libraries in `.disll` format. The compiler auto-detects them.

## Chapter 9: Debugging

### Compilation Logs

Every compilation creates a log file:

```
log.<filename>.displog
```

Example: `log.hello.displog`

Contents show:
- Input file
- Output file
- Compilation mode
- Number of tokens
- Compilation status

### Checking Generated Code

View the C code generated from your `.dis` file:

```bash
disp program.dis -o program.c
cat program.c
```

This helps understand how Displexity translates to C.

### Running the IDE

The bundled IDE provides debugging tools:

```bash
displexity-ide program.dis
```

Features:
- Syntax highlighting
- Error messages
- Log viewer
- Integrated compiler

## Chapter 10: Best Practices

### 1. Use Type Annotations
```displexity
func compute(x: int, y: int) -> int {
    return x + y
}
```

### 2. Comment Your Code
```displexity
// Calculate factorial
func factorial(n: int) -> int {
    if (n <= 1) {
        return 1
    }
}
```

### 3. Use Meaningful Names
```displexity
// Good
customer_age = 25

// Avoid
a = 25
```

### 4. Organize with Functions
```displexity
func process_input(data: string) -> int {
    // Process data
}

func output_result(result: int) {
    // Output
}
```

### 5. Handle Errors
```displexity
if (array_size < 0) {
    print "Invalid size"
}
```

## Examples

### Example 1: Fibonacci

```displexity
func fib(n: int) -> int {
    if (n <= 1) {
        return n
    }
    return fib(n - 1) + fib(n - 2)
}

result = fib(10)
print "Fibonacci"
```

### Example 2: Array Processing

```displexity
values = Array[1, 2, 3, 4, 5]
sum = 0
for (i = 0; i < 5) {
    sum = sum + values[i]
}
print "Sum"
```

### Example 3: String Manipulation

```displexity
greeting = "Hello"
name = "World"
message = greeting
print message
```

## Advanced Topics

### Direct Assembly Access

For performance-critical code, emit assembly:

```bash
disp critical.dis -emit-asm -o critical.asm
```

Manually optimize the generated assembly, then:

```bash
as critical.asm -o critical.o
gcc -c wrapper.c
gcc critical.o wrapper.o -o program
```

### Graphics API

The graphics API is abstracted to avoid platform-specific code:

```c
dis_graphics_init();
dis_graphics_draw_rect(x, y, width, height);
dis_graphics_clear();
dis_graphics_close();
```

Real graphics implementation platform-dependent (Web Canvas, OpenGL, Direct2D, etc.).

### Network Programming

HTTP functions are available:

```c
dis_http_response resp = dis_http_get(url);
// Process resp.response
dis_http_response_free(&resp);
```

Full socket support planned for v0.2.

## Troubleshooting

### Compilation Fails

1. Check log file: `log.<name>.displog`
2. Review syntax in `.dis` file
3. Ensure all required files are accessible
4. Check for missing quotes or parentheses

### Generated C Won't Compile

1. Ensure GCC is installed: `gcc --version`
2. Check that generated `.c` file is valid (readable with `cat` or `more`)
3. Look for incompatible C syntax

### Program Crashes at Runtime

1. Check array bounds
2. Verify function arguments
3. Use IDE debugger to trace execution
4. Review log files for clues

## Next Steps

1. Try the examples in `examples/`
2. Build a small project (e.g., calculator, todo app)
3. Join the community and contribute
4. Read the full language specification in `spec/LANGUAGE.md`

Happy coding with Displexity!
